SOTE.namespace("SOTE.widget.DateSpan");SOTE.widget.DateSpan=function(containerId,config){this.SLIDER_WIDTH=1000;this.DAY_IN_MS=24*60*60*1000;this.sliders=new Object();this.sliders.Year=[2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012];this.sliders.Month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.sliders.Day=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];this.months=[31,28,31,30,31,30,31,31,30,31,30,31];this.sliderContent=[];this.container=document.getElementById(containerId);if(this.container==null){this.setStatus("Error: element '"+containerId+"' not found!",true);return}this.id=containerId;this.containerId=containerId;if(config===undefined){config={}}if(config.dataSourceUrl===undefined){config.dataSourceUrl=null}if(config.thumbSource===undefined){config.thumbSource=null}if(config.extent===undefined){config.extent=null}if(config.product===undefined){config.product=null}if(config.endDate===undefined){config.endDate=new Date();var timeString=SOTE.util.zeroPad(eval(config.endDate.getUTCMonth()+1),2)+"/"+SOTE.util.zeroPad(config.endDate.getUTCDate(),2)+"/"+config.endDate.getUTCFullYear();config.endDate=new Date(timeString);config.endDate.setHours(12);config.endDate.setMinutes(0);config.endDate.setSeconds(0)}else{config.endDate=new Date(config.endDate)}if(config.startDate===undefined){config.startDate=new Date();var timeString="05/08/2012";config.startDate=new Date(timeString);config.startDate.setHours(12);config.startDate.setMinutes(0);config.startDate.setSeconds(0)}else{config.endDate=new Date(config.endDate)}if(config.range===undefined){config.range=7*this.DAY_IN_MS}if(config.selected===undefined){config.selected=new Date(config.endDate.getTime())}if(config.slideToSelect===undefined){config.slideToSelect=true}if(config.isCollapsed===undefined){config.isCollapsed=(config.thumbSource===null||config.hasThumbnail===false)?true:false}if(config.hasThumbnail===undefined){config.hasThumbnail=true}this.value="";this.maps=[];this.startDate=config.startDate;this.endDate=config.endDate;this.range=config.range;this.isCollapsed=config.isCollapsed;this.slideToSelect=config.slideToSelect;this.thumbSource=config.thumbSource;this.hasThumbnail=config.hasThumbnail;this.extent=config.extent;this.product=config.product;this.value=config.selected;this.dataSourceUrl=config.dataSourceUrl;this.statusStr="";this.init();$(window).bind("resize",{self:this},SOTE.widget.DateSpan.refreshSliders)};SOTE.widget.DateSpan.prototype=new SOTE.widget.Component;SOTE.widget.DateSpan.prototype.init=function(){this.container.setAttribute("class","datespan");var b=document.createElement("div");b.setAttribute("id",this.id+"dateHolder");b.setAttribute("class","dateHolder");b.innerHTML="Friday September 21, 2012";this.container.appendChild(b);var a=document.createElement("a");a.setAttribute("class","ecbutton collapse");a.setAttribute("id",this.id+"ecbutton");this.container.appendChild(a);this.createSlider("Year");this.createSlider("Month");this.createSlider("Day");this.setVisualDate();this.setValue(SOTE.util.ISO8601StringFromDate(this.value));$("#"+this.id+"ecbutton").bind("click",{self:this},SOTE.widget.DateSpan.toggle);if(REGISTRY){REGISTRY.register(this.id,this);REGISTRY.markComponentReady(this.id)}else{alert("No REGISTRY found!  Cannot register AccordionPicker!")}};SOTE.widget.DateSpan.refreshSliders=function(b){var a=b.data.self;setTimeout(function(){a.refreshSlider("Year");a.refreshSlider("Month");a.refreshSlider("Day")},100)};SOTE.widget.DateSpan.prototype.refreshSlider=function(type){var labels=this.sliders[type];var wwidth=$(window).width();if(labels!=undefined){var width=50/labels.length;width=width.toFixed(1);var pwidth=width/100;var pwwidth=Math.floor(pwidth*wwidth);var spacer=50/labels.length;spacer=spacer.toFixed(1);var pspacer=spacer/100;var pwspacer=Math.floor(wwidth*pspacer/2);var finalwidth=(pwwidth+pwspacer+pwspacer);$("#"+this.id+"sliderLabel"+type).children().css("width",Math.floor(wwidth*pwidth)+"px");$("#"+this.id+"sliderLabel"+type).children().css("margin-left",Math.floor(wwidth*pspacer/2)+"px");$("#"+this.id+"sliderLabel"+type).children().css("margin-right",Math.floor(wwidth*pspacer/2)+"px");$("#"+this.id+"slider"+type).siblings(".ui-slider").css("width",eval(finalwidth*labels.length)+"px")}};SOTE.widget.DateSpan.prototype.createSlider=function(type){var slider=document.createElement("div");slider.setAttribute("id",this.id+"sliderDiv"+type);slider.setAttribute("class","sliderDiv"+type+" slider");slider.innerHTML='<input type="range" name="slider" id="'+this.id+"slider"+type+'" class="dateSpanSlider" value="'+this.SLIDER_WIDTH+'" min="0" max="'+this.SLIDER_WIDTH+'" step="1" />';this.container.appendChild(slider);var width=0;var wwidth=$(window).width();var labels=this.sliders[type];if(labels!=undefined){width=50/labels.length;width=width.toFixed(1);var pwidth=width/100;var pwwidth=Math.floor(pwidth*wwidth);var spacer=50/labels.length;spacer=spacer.toFixed(1);var pspacer=spacer/100;var pwspacer=Math.floor(wwidth*pspacer/2);var finalwidth=(pwwidth+pwspacer+pwspacer);var label=document.createElement("ul");label.setAttribute("class","sliderLabel");label.setAttribute("id",this.id+"sliderLabel"+type);for(var i=0;i<labels.length;++i){var item=document.createElement("li");item.setAttribute("id",this.id+type+"sliderItem"+i);item.innerHTML=labels[i];item.style.width=Math.floor(wwidth*pwidth)+"px";item.style.marginLeft=Math.floor(wwidth*pspacer/2)+"px";item.style.marginRight=Math.floor(wwidth*pspacer/2)+"px";label.appendChild(item)}this.container.appendChild(label)}var labelslength=labels.length;$("#"+this.id+"slider"+type).slider();$("#"+this.id+"slider"+type).bind("change",{self:this,type:type},SOTE.widget.DateSpan.handleSlide);$("#"+this.id+"slider"+type).siblings(".ui-slider").css("width",eval(finalwidth*labels.length)+"px");$("#"+this.id+"slider"+type).siblings(".ui-slider").bind("vmouseup",{self:this,type:type},SOTE.widget.DateSpan.snap);if(width!=0){$(".sliderDiv"+type+" a.ui-slider-handle").css("width",eval(width*1.1).toFixed(1)+"%")}};SOTE.widget.DateSpan.prototype.fire=function(){if(REGISTRY){REGISTRY.fire(this)}else{alert("No REGISTRY found! Cannot fire to REGISTRY from AccordionPicker!")}};SOTE.widget.DateSpan.handleSlide=function(h,g){var f=h.target.value;var d=h.data.type;var c=h.data.self;var i=c.sliders[d].length;var b=Math.floor(f*(i/c.SLIDER_WIDTH));if(c.sliders[d][b]){var a=c.value.clone();if(d=="Year"){a.setYear(c.sliders[d][b])}else{if(d=="Month"){if(c.value.getDate()>c.months[b]){a.setDate(c.months[b]);a.setMonth(b);c.setValue(SOTE.util.ISO8601StringFromDate(a))}else{a.setMonth(b)}}else{if(d=="Day"){if(c.sliders[d][b]<=c.months[c.value.getMonth()]){a.setDate(c.sliders[d][b])}else{a.setDate(c.months[c.value.getMonth()]);c.setValue(SOTE.util.ISO8601StringFromDate(a))}}}}if(a.getTime()<c.startDate.getTime()){c.setValue(SOTE.util.ISO8601StringFromDate(c.startDate))}else{if(a.getTime()>c.endDate.getTime()){c.setValue(SOTE.util.ISO8601StringFromDate(c.endDate))}else{c.value=a.clone()}}}else{if(b>=c.sliders[d].length){c.setValue(SOTE.util.ISO8601StringFromDate(c.value))}else{if(b<0){c.setValue(SOTE.util.ISO8601StringFromDate(c.value))}}}c.validate();c.setVisualDate();c.fire()};SOTE.widget.DateSpan.toggle=function(c,b){var a=c.data.self;if(a.isCollapsed){$(".ecbutton").removeClass("expand").addClass("collapse");$(".ecbutton").attr("title","Hide Date Sliders");a.isCollapsed=false;a.showSliders()}else{$(".ecbutton").removeClass("collapse").addClass("expand");$(".ecbutton").attr("title","Show Date Sliders");a.isCollapsed=true;a.hideSliders()}};SOTE.widget.DateSpan.snap=function(c,f){var k=c.data.self;var d=c.data.type;var j=k.sliders[d].length;var i=$("#"+k.id+"slider"+d).val();var g=Math.floor(i*(j/k.SLIDER_WIDTH));var a=k.SLIDER_WIDTH/j;var b=g*a+a/4-a*0.05;b=b.toFixed(1);$("#"+k.id+"slider"+d).val((b)).slider("refresh");if(k.sliders[d][g]){var h=k.value.clone();if(d=="Year"){h.setYear(k.sliders[d][g])}else{if(d=="Month"){if(k.value.getDate()>k.months[g]){h.setDate(k.months[g]);h.setMonth(g);k.setValue(SOTE.util.ISO8601StringFromDate(h))}else{h.setMonth(g)}}else{if(d=="Day"){if(k.sliders[d][g]<=k.months[k.value.getMonth()]){h.setDate(k.sliders[d][g])}else{h.setDate(k.months[k.value.getMonth()]);k.setValue(SOTE.util.ISO8601StringFromDate(h))}}}}if(h.getTime()<k.startDate.getTime()){k.setValue(SOTE.util.ISO8601StringFromDate(k.startDate))}else{if(h.getTime()>k.endDate.getTime()){k.setValue(SOTE.util.ISO8601StringFromDate(k.endDate))}else{k.value=h.clone()}}}else{if(g>=k.sliders[d].length){k.setValue(SOTE.util.ISO8601StringFromDate(k.value))}else{if(g<0){k.setValue(SOTE.util.ISO8601StringFromDate(k.value))}}}k.validate();k.setVisualDate()};SOTE.widget.DateSpan.snapToTime=function(d,b){var a=d.data.self;var c=d.data.time};SOTE.widget.DateSpan.prototype.hideSliders=function(){for(var a in this.sliders){$("#"+this.id+"sliderDiv"+a).css("display","none")}};SOTE.widget.DateSpan.prototype.showSliders=function(){for(var a in this.sliders){$("#"+this.id+"sliderDiv"+a).css("display","block")}};SOTE.widget.DateSpan.prototype.setValue=function(j){var h=SOTE.util.getValuesFromISO8601String(j);if(h[2]>this.months[h[1]]){h[2]=this.months[h[1]]}var f=new Date(h[0],h[1],h[2],h[3],h[4],h[5]);var b=this.endDate.getTime()-(this.range-24*60*60*1000);var e=["January","February","March","April","May","June","July","August","September","October","November","December"];if(f.getTime()<=this.endDate.getTime()&&f.getTime()>=this.startDate.getTime()){this.value=f;var k=new Object();k.Year=this.sliders.Year.indexOf(this.value.getFullYear());k.Month=this.value.getMonth();k.Day=this.sliders.Day.indexOf(this.value.getDate());for(var g in k){var l=this.sliders[g].length;var i=k[g];var a=this.SLIDER_WIDTH/l;var c=i*a+(a/4)-(a*0.05);c=c.toFixed(1);$("#"+this.id+"slider"+g).val(c).slider("refresh")}this.validate();this.setVisualDate();this.fire()}else{SOTE.util.throwError("The date "+j+" in your permalink has expired.  As of right now, Worldview only retains data as of "+SOTE.util.ISO8601StringFromDate(this.startDate)+".  The date has been adjusted to today's date.")}};SOTE.widget.DateSpan.prototype.setVisualDate=function(){var dateString=this.value.getFullYear()+"-"+SOTE.util.zeroPad(eval(this.value.getMonth()+1),2)+"-"+SOTE.util.zeroPad(this.value.getDate(),2);$("#"+this.id+"dateHolder").html(dateString)};SOTE.widget.DateSpan.prototype.getValue=function(){return""+this.id+"="+SOTE.util.ISO8601StringFromDate(this.value)+"&transition=standard"};SOTE.widget.DateSpan.prototype.updateComponent=function(a){};SOTE.widget.DateSpan.prototype.loadFromQuery=function(a){return this.setValue(SOTE.util.extractFromQuery(this.id,a))};SOTE.widget.DateSpan.prototype.validate=function(){var k=this.value.clone();var f=this.startDate.getFullYear();var h=this.startDate.getMonth();var e=this.startDate.getDate();var j=this.endDate.getFullYear();var d=this.endDate.getMonth();var b=this.endDate.getDate();for(var g in this.sliders){for(var c=0;c<this.sliders[g].length;++c){var a=this.id+g+"sliderItem"+c;if(g=="Year"){if(this.sliders[g][c]<f||this.sliders[g][c]>j){$("#"+a).addClass("disabledItem")}else{$("#"+a).removeClass("disabledItem")}}if(g=="Month"){if((k.getFullYear()==f&&c<h)||(k.getFullYear()==j&&c>d)){$("#"+a).addClass("disabledItem")}else{$("#"+a).removeClass("disabledItem")}}if(g=="Day"){if((this.sliders[g][c]>this.months[k.getMonth()])||(k.getFullYear()==f&&k.getMonth()==h&&this.sliders[g][c]<e)||(k.getFullYear()==j&&k.getMonth()==d&&this.sliders[g][c]>b)){$("#"+a).addClass("disabledItem")}else{$("#"+a).removeClass("disabledItem")}}}}};SOTE.widget.DateSpan.prototype.setDataSourceUrl=function(a){};SOTE.widget.DateSpan.prototype.getDataSourceUrl=function(){};SOTE.widget.DateSpan.prototype.setStatus=function(a){};SOTE.widget.DateSpan.prototype.getStatus=function(){};SOTE.widget.DateSpan.prototype.hide=function(){};SOTE.widget.DateSpan.prototype.show=function(){};SOTE.widget.DateSpan.prototype.expand=function(){};SOTE.widget.DateSpan.prototype.collapse=function(){};
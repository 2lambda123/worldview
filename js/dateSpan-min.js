SOTE.namespace("SOTE.widget.DateSpan");SOTE.widget.DateSpan=function(containerId,config){this.container=document.getElementById(containerId);if(this.container==null){this.setStatus("Error: element '"+containerId+"' not found!",true);return}this.id=containerId;this.containerId=containerId;if(config===undefined){config={}}if(config.dataSourceUrl===undefined){config.dataSourceUrl=null}if(config.thumbSource===undefined){config.thumbSource=null}if(config.extent===undefined){config.extent=null}if(config.product===undefined){config.product=null}if(config.endDate===undefined){config.endDate=new Date();var timeString=SOTE.util.zeroPad(eval(config.endDate.getUTCMonth()+1),2)+"/"+SOTE.util.zeroPad(config.endDate.getUTCDate(),2)+"/"+config.endDate.getUTCFullYear();config.endDate=new Date(timeString);config.endDate.setHours(12);config.endDate.setMinutes(0);config.endDate.setSeconds(0)}else{config.endDate=new Date(config.endDate)}if(config.range===undefined){config.range=7*24*60*60*1000}if(config.selected===undefined){config.selected=new Date(config.endDate.getTime())}if(config.slideToSelect===undefined){config.slideToSelect=true}if(config.isCollapsed===undefined){config.isCollapsed=(config.thumbSource===null||config.hasThumbnail===false)?true:false}if(config.hasThumbnail===undefined){config.hasThumbnail=true}this.value="";this.maps=[];this.endDate=config.endDate;this.range=config.range;this.isCollapsed=config.isCollapsed;this.slideToSelect=config.slideToSelect;this.thumbSource=config.thumbSource;this.hasThumbnail=config.hasThumbnail;this.extent=config.extent;this.product=config.product;this.value=config.selected;this.dataSourceUrl=config.dataSourceUrl;this.statusStr="";this.init()};SOTE.widget.DateSpan.prototype=new SOTE.widget.Component;SOTE.widget.DateSpan.prototype.init=function(){this.container.setAttribute("class","datespan");var j=document.createElement("a");j.setAttribute("class","ecbutton collapse");this.container.appendChild(j);var c=document.createElement("div");c.setAttribute("class","spanContainer");c.setAttribute("id",this.id+"spanContainer");this.container.appendChild(c);var g=this.range/24/60/60/1000;var d=new Date(this.endDate.getTime()-this.range);for(var h=0;h<g;++h){var l=document.createElement("div");l.setAttribute("id","mapdiv"+h);l.setAttribute("class","dateitem");c.appendChild(l);var f=new Date(d.getTime()+(h+1)*24*60*60*1000);var a=SOTE.util.ISO8601StringFromDate(f);this.maps.push(new SOTE.widget.Map("mapdiv"+h,{baseLayer:"MODIS_Terra_CorrectedReflectance_TrueColor",time:a,hasControls:false}));$("#mapdiv"+h).bind("click",{self:this,time:f.clone()},SOTE.widget.DateSpan.snapToTime)}var b=document.createElement("div");b.setAttribute("id",this.id+"sliderDiv");b.innerHTML='<input type="range" name="slider" id="'+this.id+'slider" class="dateSpanSlider" value="100" min="0" max="100" step="1" />';c.appendChild(b);$("#"+this.id+"slider").slider();$("#"+this.id+"slider").bind("change",{self:this},SOTE.widget.DateSpan.handleSlide);$("#"+this.id+"slider").siblings(".ui-slider").bind("vmouseup",{self:this},SOTE.widget.DateSpan.snap);$(".ecbutton").bind("click",{self:this},SOTE.widget.DateSpan.toggle);this.isCollapsed=true;if(this.isCollapsed){this.isCollapsed=false;var k=new Object();k.data=new Object();k.data.self=this;SOTE.widget.DateSpan.toggle(k)}this.spanDate=document.getElementById(this.id+"spanContainerLabelDate");this.spanDay=document.getElementById(this.id+"spanContainerLabelDay");this.setVisualDate();if(REGISTRY){REGISTRY.register(this.id,this);REGISTRY.markComponentReady(this.id)}else{alert("No REGISTRY found!  Cannot register AccordionPicker!")}};SOTE.widget.DateSpan.prototype.fire=function(){if(REGISTRY){REGISTRY.fire(this)}else{alert("No REGISTRY found! Cannot fire to REGISTRY from AccordionPicker!")}};SOTE.widget.DateSpan.handleSlide=function(g,d){var c=g.target.value;var b=g.data.self;var a=(b.range-(24*60*60*1000))*(100-c)/100;var f=new Date(b.endDate.getTime()-a);if(b.value.getTime()!==f.getTime()){b.value=f.clone();b.setVisualDate();b.fire()}};SOTE.widget.DateSpan.toggle=function(c,b){var a=c.data.self;if(a.isCollapsed){$(".ecbutton").removeClass("expand").addClass("collapse");$(".ecbutton").attr("title","Hide Date Thumbnails");$("a.ui-slider-handle").css("top","-142px");a.isCollapsed=false;a.showMaps();a.updateComponent(a.cachedQs)}else{$(".ecbutton").removeClass("collapse").addClass("expand");$(".ecbutton").attr("title","Show Date Thumbnails");$("a.ui-slider-handle").css("top","-25px");a.isCollapsed=true;a.hideMaps()}};SOTE.widget.DateSpan.snap=function(g,d){var b=g.data.self;var c=$("#"+b.id+"slider").val();var a=(b.range-(24*60*60*1000))*(100-c)/100;var f=new Date(b.endDate.getTime()-a);f.setHours(12);f.setMinutes(0);f.setSeconds(0);b.setValue(SOTE.util.ISO8601StringFromDate(f))};SOTE.widget.DateSpan.snapToTime=function(d,b){var a=d.data.self;var c=d.data.time;a.setValue(SOTE.util.ISO8601StringFromDate(c))};SOTE.widget.DateSpan.prototype.hideMaps=function(){for(var a=0;a<this.maps.length;++a){$("#"+this.maps[a].id).css("display","none")}};SOTE.widget.DateSpan.prototype.showMaps=function(){for(var a=0;a<this.maps.length;++a){$("#"+this.maps[a].id).css("display","block")}};SOTE.widget.DateSpan.prototype.setValue=function(b){var e=SOTE.util.UTCDateFromISO8601String(b);var a=this.endDate.getTime()-(this.range-24*60*60*1000);if(e.getTime()<=this.endDate.getTime()&&e.getTime()>=a){this.value=e.clone();var c=((this.endDate.getTime()-this.value.getTime())/(this.range-24*60*60*1000))*100;$("#"+this.id+"slider").val(100-c).slider("refresh");this.setVisualDate();this.fire()}else{SOTE.util.throwError("The date in your permalink has expired.  As of right now, Worldview only retains the past 7 days of data.  The date has been adjusted to today's date.")}};SOTE.widget.DateSpan.prototype.setVisualDate=function(){var dateString=this.value.getFullYear()+"-"+SOTE.util.zeroPad(eval(this.value.getMonth()+1),2)+"-"+SOTE.util.zeroPad(this.value.getDate(),2);$("a.ui-slider-handle").html("<span class='sliderText'>"+dateString+"</span>")};SOTE.widget.DateSpan.prototype.getValue=function(){return""+this.id+"="+SOTE.util.ISO8601StringFromDate(this.value)+"&transition=standard"};SOTE.widget.DateSpan.prototype.updateComponent=function(k){var n=SOTE.util.extractFromQuery("map",k);var l=SOTE.util.extractFromQuery("products",k);var m=l.split("~");var j=new Array();var d=m[0].split(".");var c=m[1].split(".");for(var h=1;h<d.length;++h){j.push(d[h])}for(var h=1;h<c.length;++h){j.push(c[h])}if(this.isCollapsed==false){var g=this.range/24/60/60/1000;var e=new Date(this.endDate.getTime()-this.range);for(var h=0;h<g;h++){var f=new Date(e.getTime()+(h+1)*24*60*60*1000);var b=SOTE.util.ISO8601StringFromDate(f);this.maps[h].updateComponent(k);this.maps[h].activateRelevantLayersDisableTheRest(j,b);this.maps[h].setValue(n)}}else{this.cachedQs=k}};SOTE.widget.DateSpan.prototype.loadFromQuery=function(a){return this.setValue(SOTE.util.extractFromQuery(this.id,a))};SOTE.widget.DateSpan.prototype.validate=function(){};SOTE.widget.DateSpan.prototype.setDataSourceUrl=function(a){};SOTE.widget.DateSpan.prototype.getDataSourceUrl=function(){};SOTE.widget.DateSpan.prototype.setStatus=function(a){};SOTE.widget.DateSpan.prototype.getStatus=function(){};SOTE.widget.DateSpan.prototype.hide=function(){};SOTE.widget.DateSpan.prototype.show=function(){};SOTE.widget.DateSpan.prototype.expand=function(){};SOTE.widget.DateSpan.prototype.collapse=function(){};
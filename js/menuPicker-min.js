SOTE.namespace("SOTE.widget.MenuPicker");SOTE.widget.MenuPicker.prototype=new SOTE.widget.Component;SOTE.widget.MenuPicker=function(a,b){this.container=document.getElementById(a);if(this.container==null){this.setStatus("Error: element '"+a+"' not found!");return}this.id=a;if(b===undefined){b={}}if(b.isCollapsible===undefined){b.isCollapsible=false}if(b.dataSourceUrl===undefined){b.dataSourceUrl=null}this.selectedValue=null;this.menuIsCollapsible=b.isCollapsible;this.dataSourceUrl=b.dataSourceUrl;this.initRenderComplete=false;this.statusStr="";this.init()};SOTE.widget.MenuPicker.prototype.init=function(){this.updateComponent();if(REGISTRY){REGISTRY.register(this.id,this)}else{alert("No REGISTRY so could not register MenuPicker")}};SOTE.widget.MenuPicker.prototype.render=function(){this.container.innerHTML="";$("#"+this.id).undelegate("click");var a=document.createElement("ul");var d="menuPicker";if(this.menuIsCollapsible===true){d+=" collapsible"}a.setAttribute("class",d);for(var c=0;c<this.menuItems.length;c++){var b=this.id+"_item"+c;this.menuItems[c].liID=b;var e=document.createElement("li");e.setAttribute("id",b);e.innerHTML="<div>"+this.menuItems[c].label+"</div>";if((this.selectedValue!==null)&&(this.menuItems[c].value===this.selectedValue)){this.setValue(this.menuItems[c].value);e.setAttribute("class","selected")}a.appendChild(e);if(this.menuItems[c].disabled!==true){$("#"+this.id).delegate("#"+b,"click",{val:this.menuItems[c].value,self:this},SOTE.widget.MenuPicker.bindClick)}else{e.setAttribute("class","disabled")}}if((this.initRenderComplete===false)&&REGISTRY){this.initRenderComplete=true;REGISTRY.markComponentReady(this.id)}this.container.appendChild(a)};SOTE.widget.MenuPicker.bindClick=function(a){a.data.self.setValue(a.data.val)};SOTE.widget.MenuPicker.prototype.fire=function(){if(REGISTRY){REGISTRY.fire(this)}else{alert("No REGISTRY so no event REGISTRY event to fire")}};SOTE.widget.MenuPicker.prototype.setValue=function(d){var c=this.selectedValue;var b=this.selectedId;this.selectedValue=d;var a=this.validate();if(a){$("#"+b).removeClass("selected");$("#"+this.selectedId).addClass("selected")}else{this.selectedValue=c}this.fire();return a};SOTE.widget.MenuPicker.prototype.getValue=function(){return this.id+"="+this.selectedValue};SOTE.widget.MenuPicker.prototype.updateComponent=function(b){var a=(b===undefined)?"":b;if(this.dataSourceUrl!==null){SOTE.util.getJSON(this.dataSourceUrl+"?"+a,{self:this},SOTE.widget.MenuPicker.handleUpdateSuccess,SOTE.widget.MenuPicker.handleUpdateFailure)}};SOTE.widget.MenuPicker.handleUpdateSuccess=function(d,a,e,b){var c=SOTE.util.extractFromQuery(b.self.id,b.self.getValue());b.self.menuItems=d.items;b.self.selectedValue=d.selected;if(!b.self.setValue(c)){b.self.value=null}b.self.render()};SOTE.widget.MenuPicker.handleUpdateFailure=function(d,a,c,b){alert("Failed to load data accessor: "+c)};SOTE.widget.MenuPicker.prototype.loadFromQuery=function(a){return this.setValue(SOTE.util.extractFromQuery(this.id,a))};SOTE.widget.MenuPicker.prototype.validate=function(){var c=false;var a=false;for(var b=0;b<this.menuItems.length;b++){if((this.menuItems[b].value===this.selectedValue)&&(this.menuItems[b].disabled!==true)){c=true;a=true;this.selectedId=this.menuItems[b].liID;break}else{if(this.menuItems[b].value===this.selectedValue){this.setStatus("List item with value = "+this.menuItems[b].value+" is disabled");a=true;break}}}if(a==false){this.setStatus("List item value = "+this.selectedValue+" is not valid")}return c};SOTE.widget.MenuPicker.prototype.setDataSourceUrl=function(a){this.dataSourceUrl=a};SOTE.widget.MenuPicker.prototype.getDataSourceUrl=function(){return this.dataSourceUrl};SOTE.widget.MenuPicker.prototype.setStatus=function(a){this.statusStr=a};SOTE.widget.MenuPicker.prototype.getStatus=function(){return this.statusStr};SOTE.widget.MenuPicker.prototype.addItem=function(a){};SOTE.widget.MenuPicker.prototype.removeItem=function(a){};SOTE.widget.MenuPicker.prototype.length=function(){};
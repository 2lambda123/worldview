SOTE.namespace("SOTE.widget.AccordionPicker");SOTE.widget.AccordionPicker.prototype=new SOTE.widget.Component;SOTE.widget.AccordionPicker=function(a,b){this.container=document.getElementById(a);if(this.container==null){this.setStatus("Error: element '"+a+"' not found!",true);return}this.id=a;this.containerId=a;if(b===undefined){b={}}if(b.dataSourceUrl===undefined){b.dataSourceUrl=null}if(b.items===undefined){b.items=null}if(b.selected===undefined){b.selected=null}this.value="";this.selected=b.selected;this.expanded=null;this.initRenderComplete=false;this.dataSourceUrl=b.dataSourceUrl;this.statusStr="";this.init();this.updateComponent("")};SOTE.widget.AccordionPicker.prototype.init=function(){this.render();if(REGISTRY){REGISTRY.register(this.id,this)}else{alert("No REGISTRY found!  Cannot register AccordionPicker!")}};SOTE.widget.AccordionPicker.prototype.render=function(){if(this.items===undefined){return false}this.container.innerHTML="";var j;var d;var g=null;var k=document.createElement("form");k.setAttribute("class","accordion");k.setAttribute("id",this.id+"accordion");for(var b in this.items){if(b==="expanded"){if(this.items[b]!==undefined&&this.items[b]!==""){j=this.items[b].replace(" ","")}continue}if(b==="selected"){d=this.items[b];continue}var r=b.replace(" ","");var q=document.createElement("a");q.setAttribute("href","#");q.setAttribute("id",this.id+r);q.innerHTML="<span>"+b+"</span>";k.appendChild(q);var f=document.createElement("ul");for(var h=0;h<this.items[b].length;h++){var o=this.items[b][h];var p=document.createElement("li");if(o.type!=="single"&&o.type!=="multi"){alert("Invalid list item!")}else{var a=this.id+r+"Item"+h;var c=(o.disabled!==undefined&&o.disabled===true)?"disabled":"";var m=(o.type==="single")?"radio":"checkbox";p.innerHTML="<input value='"+o.value+"' class='accordionFormItem' name='"+this.id+o.type+"' id='"+a+"' type='"+m+"' "+c+"/>";p.innerHTML+="<label for='"+a+"'><span class='accordionLabel'>"+o.label+"</span><span class='accordionSub'>"+o.sublabel+"</span></label>";f.appendChild(p)}}k.appendChild(f)}this.container.appendChild(k);var n=document.createElement("a");n.setAttribute("class","accordionToggler atcollapse");this.isCollapsed=false;var l=new Object();l.data=new Object();l.data.self=this;this.container.appendChild(n);$(".accordionToggler").bind("click",{self:this},SOTE.widget.AccordionPicker.toggle);$(".accordion").accordion();$(".accordion").bind("accordionchange",{self:this},SOTE.widget.AccordionPicker.handleCategorySwitch);$(".accordionFormItem").bind("click",{self:this},SOTE.widget.AccordionPicker.handleSelection);if(d!==undefined&&d!==""){this.setValue(j+"."+d)}if((this.initRenderComplete===false)&&REGISTRY){this.initRenderComplete=true;REGISTRY.markComponentReady(this.id)}};SOTE.widget.AccordionPicker.handleSelection=function(b){var a=b.data.self;a.syncCheckboxes(b.target);a.value=SOTE.util.extractFromQuery(a.id,a.getValue());a.fire()};SOTE.widget.AccordionPicker.toggle=function(c,b){var a=c.data.self;if(a.isCollapsed){$(".accordionToggler").removeClass("atexpand").addClass("atcollapse");$(".accordionToggler").attr("title","Hide Products");$(".accordion").css("display","block");a.isCollapsed=false}else{$(".accordionToggler").removeClass("atcollapse").addClass("atexpand");$(".accordionToggler").attr("title","Show Products");$(".accordion").css("display","none");a.isCollapsed=true}};SOTE.widget.AccordionPicker.handleCategorySwitch=function(f,g){var k=f.data.self;var d=(g.oldHeader[0].id);var j=(g.newHeader[0].id);var l=null;var a=false;if(k.expanded!==j){k.expanded=j;var c=document.getElementsByName(k.id+"single");for(var b=0;b<c.length;++b){if(c[b].disabled===false&&c[b].id.indexOf(d)!=-1&&c[b].checked===true){l=c[b].value}}if(l!==null){for(var b=0;b<c.length;++b){if(c[b].disabled===false&&c[b].id.indexOf(j)!=-1&&c[b].value===l){c[b].checked=true;a=true}}}var h}$(".accordion").blur()};SOTE.widget.AccordionPicker.prototype.fire=function(){if(REGISTRY){REGISTRY.fire(this)}else{alert("No REGISTRY found! Cannot fire to REGISTRY from AccordionPicker!")}};SOTE.widget.AccordionPicker.prototype.setValue=function(l){var e=l.split(".");var k=e[0];var b=e[1];var g=document.getElementsByName(this.id+"single");var m=false;var a=k;var c=new RegExp(this.id+"(.+)");if(c.test(k)==false){a=this.id+k}if(this.expanded===null||this.expanded!==a){$(".accordion").accordion("activate","#"+a);this.expanded=a}for(var f=0;f<g.length;++f){if(g[f].value===b&&g[f].disabled===false&&g[f].id.indexOf(k)!=-1){g[f].checked=true;m=true;break}}if(!m){for(var f=0;f<g.length;++f){if(g[f].value===b&&g[f].disabled===false){g[f].checked=true}}}var h=document.getElementsByName(this.id+"multi");for(var f=0;f<h.length;++f){for(var d=1;d<e.length;++d){if(h[f].value===e[d]&&h[f].disabled===false){h[f].checked=true}}}this.value=l;this.fire();$(".accordion").blur();return this.validate()};SOTE.widget.AccordionPicker.prototype.syncCheckboxes=function(d){var b=d.checked;var c=document.getElementsByName(this.id+"multi");for(var a=0;a<c.length;++a){if(c[a].value===d.value&&c[a].disabled===false){c[a].checked=b}}return};SOTE.widget.AccordionPicker.prototype.getValue=function(){var f=new Array();var e=new Object();var d=document.getElementsByName(this.id+"single");for(var b=0;b<d.length;++b){if(d[b].checked===true){f.push(d[b].value);break}}if(f.length===0){f.push("")}var h=document.getElementsByName(this.id+"multi");for(var b=0;b<h.length;++b){if(h[b].checked===true){if(!(h[b].value in e)){f.push(h[b].value);e[h[b].value]=1}}}var c=new RegExp(this.id+"(.+)");var a=c.exec(this.expanded);var g=a[1]+"."+f.join(".");return this.id+"="+g};SOTE.widget.AccordionPicker.prototype.updateComponent=function(b){var a=(b===undefined)?"":b;SOTE.util.getJSON(this.dataSourceUrl+"?"+b,{self:this,qs:b},SOTE.widget.AccordionPicker.handleUpdateSuccess,SOTE.widget.AccordionPicker.handleUpdateFailure)};SOTE.widget.AccordionPicker.handleUpdateSuccess=function(d,a,e,c){var b=SOTE.util.extractFromQuery("hazard",c.qs);d.expanded=(b!==undefined&&b!==""&&b!==null)?b:d.expanded;d.selected=(d.selected===undefined||d.selected==="")?SOTE.util.extractFromQuery(c.self.id,c.self.getValue()):d.selected;c.self.items=d;c.self.render()};SOTE.widget.AccordionPicker.handleUpdateFailure=function(d,a,c,b){alert("Failed to load data accessor: "+c)};SOTE.widget.AccordionPicker.prototype.loadFromQuery=function(a){return this.setValue(SOTE.util.extractFromQuery(this.id,a))};SOTE.widget.AccordionPicker.prototype.validate=function(){var d=true;var a=0;var c=document.getElementsByName(this.id+"single");for(var b=0;b<c.length;++b){if(c[b].checked===true){++a}if(c[b].disabled===true&&c[b].checked===true){this.setStatus("Disabled items cannot be selected!");d=false}}if(a>1){d=false;this.setStatus("Multiple single-select items selected!")}return d};SOTE.widget.AccordionPicker.prototype.setDataSourceUrl=function(a){this.dataSourceUrl=a};SOTE.widget.AccordionPicker.prototype.getDataSourceUrl=function(){return this.dataSourceUrl};SOTE.widget.AccordionPicker.prototype.setStatus=function(a){this.statusStr=a};SOTE.widget.AccordionPicker.prototype.getStatus=function(){return this.statusStr};
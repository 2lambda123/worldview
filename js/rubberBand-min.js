SOTE.namespace("SOTE.widget.RubberBand");SOTE.widget.RubberBand=function(a,b){this.container=document.getElementById(a);this.coords=null;if(this.container==null){this.setStatus("Error: element '"+a+"' not found!",true);return}if(b===undefined){b={}}this.icon=b.icon;this.onicon=b.onicon;this.cropee=b.cropee;this.projectionSwitch="geographic";this.id=a;this.state="off";this.jcropAPI=null;this.init()};SOTE.widget.RubberBand.prototype=new SOTE.widget.Component;SOTE.widget.RubberBand.prototype.init=function(){this.container.setAttribute("class","rubberband");this.container.innerHTML="<a id='"+this.id+"camera_link' class='toolbaricon'><img src='"+this.icon+"' /></a>";$("#"+this.id+"camera_link").bind("click",{self:this},SOTE.widget.RubberBand.toggle);if(REGISTRY){REGISTRY.register(this.id,this);REGISTRY.markComponentReady(this.id)}else{alert("No REGISTRY found!  Cannot register Rubber Band!")}};SOTE.widget.RubberBand.toggle=function(b){var a=b.data.self;if(a.state=="off"){a.state="on";$("#"+a.id+"camera_link img").attr("src",a.onicon);$("#imagedownload").show("slide",{direction:"up"},1000);a.draw()}else{a.state="off";$("#"+a.id+"camera_link img").attr("src",a.icon);a.jcropAPI.destroy();$("#imagedownload").hide("slide",{direction:"up"},1000)}};SOTE.widget.RubberBand.prototype.setValue=function(a){this.coords=a;this.fire()};SOTE.widget.RubberBand.prototype.getValue=function(){if(this.coords){var a=this.id+"="+this.coords.x+","+this.coords.y+","+this.coords.x2+","+this.coords.y2+","+this.coords.w+","+this.coords.h;return a}else{return}};SOTE.widget.RubberBand.prototype.updateComponent=function(a){this.projectionSwitch=SOTE.util.extractFromQuery("switch",a)};SOTE.widget.RubberBand.prototype.loadFromQuery=function(a){return this.setValue(SOTE.util.extractFromQuery(this.id,a))};SOTE.widget.RubberBand.prototype.validate=function(){};SOTE.widget.RubberBand.prototype.setSourceUrl=function(a){};SOTE.widget.RubberBand.prototype.getSourceUrl=function(){};SOTE.widget.RubberBand.prototype.setStatus=function(a){};SOTE.widget.RubberBand.prototype.getStatus=function(){};SOTE.widget.RubberBand.prototype.draw=function(){if(this.projectionSwitch!="geographic"){alert("The download feature is currently available for geograpic projection only.");return -1}var a=this;$("#"+this.cropee).Jcrop({bgColor:"black",bgOpacity:0.3,onSelect:function(b){SOTE.widget.RubberBand.handleChange(b,a)},onChange:function(b){SOTE.widget.RubberBand.handleChange(b,a)},fullScreen:true});this.jcropAPI=$("#"+this.cropee).data("Jcrop");this.jcropAPI.setSelect([($(window).width()/2)-100,($(window).height()/2)-100,($(window).width()/2)+100,($(window).height()/2)+100])};SOTE.widget.RubberBand.handleChange=function(b,a){a.setValue(b)};SOTE.widget.RubberBand.prototype.fire=function(){if(REGISTRY){REGISTRY.fire(this)}else{alert("No REGISTRY found! Cannot fire to REGISTRY from Map!")}};
SOTE.namespace("SOTE.widget.Selector");SOTE.widget.Selector.prototype=new SOTE.widget.Component;SOTE.widget.Selector=function(a,b){this.container=document.getElementById(a);if(this.container==null){this.setStatus("Error: element '"+a+"' not found!",true);return}this.id=a;this.containerId=a;if(b===undefined){b={}}if(b.categories===undefined){b.categories=["Category 1","Category 2"]}if(b.state===undefined){b.state="geographic"}this.values=new Object;this.state=b.state;this.meta=new Object;this.categories=b.categories;this.initRenderComplete=false;this.dataSourceUrl=b.dataSourceUrl;this.statusStr="";this.init()};SOTE.widget.Selector.prototype.init=function(){this.loadData();if(REGISTRY){REGISTRY.register(this.id,this)}else{alert("No REGISTRY found!  Cannot register Selector!")}};SOTE.widget.Selector.prototype.loadData=function(){SOTE.util.getJSON("data/"+this.state+"_"+this.dataSourceUrl,{self:this},SOTE.widget.Selector.handleLoadSuccess,SOTE.widget.Selector.handleUpdateFailure)};SOTE.widget.Selector.handleLoadSuccess=function(d,a,e,c){var b=c.self;b.data=d;b.render()};SOTE.widget.Selector.prototype.render=function(){this.container.innerHTML="";$("#"+this.id).addClass("selector");var d=document.createElement("ul");d.setAttribute("class","toplevel");var a=document.createElement("div");var h=document.createElement("h2");h.innerHTML="Choose Your Interest Area";a.appendChild(h);this.container.appendChild(a);var f=0;for(var c in this.data){f++;if(c!=="All"&&c!=="palettes"){var b=document.createElement("li");var g=c.replace(/\s/g,"");itemLink=document.createElement("a");itemLink.setAttribute("id",g);itemLink.innerHTML="<img src='images/"+g.toLowerCase()+".png' /><p>"+c+"</p>";b.appendChild(itemLink);d.appendChild(b);$("#"+this.id).delegate("#"+g,"click",{self:this,category:c},SOTE.widget.Selector.loadCategory)}}if(f<=2){SOTE.widget.Selector.loadCategory({data:{self:this,category:"All"},back:true});return}this.container.appendChild(d);var e=document.createElement("a");e.setAttribute("id","subfront");e.setAttribute("class","flowbutton");e.setAttribute("href","javascript:void(0);");e.innerHTML="<b>skip this step</b> to see all available layers >>";this.container.appendChild(e);$("#"+this.id).delegate("#subfront","click",{self:this,category:"All"},SOTE.widget.Selector.loadCategory);if((this.initRenderComplete===false)&&REGISTRY){this.initRenderComplete=true;REGISTRY.markComponentReady(this.id)}};SOTE.widget.Selector.callRender=function(a){a.data.self.openCat=null;a.data.self.render()};SOTE.widget.Selector.prototype.reloadCategory=function(){var a=new Object;a.data=new Object;a.data.self=this;a.data.category=this.openCat;SOTE.widget.Selector.loadCategory(a)};SOTE.widget.Selector.loadCategory=function(q){var l=q.data.self;var g=q.data.category;l.openCat=g;var o=(q.back)?false:true;var n=new Object;l.container.innerHTML="";var t=document.createElement("div");var u=document.createElement("h2");u.innerHTML="Choose Your Layers: "+g;t.appendChild(u);l.container.appendChild(t);var d=document.createElement("form");for(var p=0;p<l.categories.length;p++){var r=l.categories[p].replace(/\s/g,"");n[r.toLowerCase()]=document.createElement("ul");n[r.toLowerCase()].setAttribute("id",l.id+r.toLowerCase());n[r.toLowerCase()].setAttribute("class","category");var m=document.createElement("li");var k=document.createElement("h3");k.setAttribute("class","head");k.innerHTML=l.categories[p];m.appendChild(k);n[r.toLowerCase()].appendChild(m)}for(var p=0;p<l.data[g].length;p++){var s=l.data[g][p];var j=document.createElement("li");j.setAttribute("class","selectorItem item");var b=document.createElement("h4");var c=s.value.replace(/:/g,"colon");b.innerHTML=s.label;var h=document.createElement("p");h.innerHTML=s.sublabel;var a=document.createElement("input");if(s.type==="single"){a.setAttribute("type","radio");a.setAttribute("name",g)}else{a.setAttribute("type","checkbox")}a.setAttribute("id",c);a.setAttribute("value",s.value);j.appendChild(a);j.appendChild(b);j.appendChild(h);n[s.category].appendChild(j);$("#"+l.id).delegate("#"+c,"click",{self:l},SOTE.widget.Selector.toggleValue)}for(var p=0;p<l.categories.length;p++){var r=l.categories[p].replace(/\s/g,"").toLowerCase();d.appendChild(n[r])}l.container.appendChild(d);if(o){var f=document.createElement("a");f.setAttribute("id","subback");f.setAttribute("class","flowbutton");f.setAttribute("href","javascript:void(0);");f.innerHTML="<< <b>go back</b> and reselect my interest area";l.container.appendChild(f);$("#"+l.id).delegate("#subback","click",{self:l},SOTE.widget.Selector.callRender)}l.adjustSelected()};SOTE.widget.Selector.prototype.renderCanvases=function(a){for(var e=0;e<this.data[a].length;e++){var g=this.data[a][e];if(this.data.palettes[g.value]){var h=this.data.palettes[g.value];var f=100/h.palette.length;var c=document.getElementById("canvas"+this.id+g.value);var d=c.getContext("2d");for(var b=0;b<h.palette.length;++b){d.fillStyle="rgba("+h.palette[b]+")";d.fillRect(f*b,0,f,14)}}}};SOTE.widget.Selector.prototype.adjustSelected=function(){var a=document.getElementsByTagName("input");for(var d=0;d<a.length;d++){a[d].checked=""}for(var c=0;c<this.categories.length;c++){var e=this.categories[c].replace(/\s/g,"");e=e.toLowerCase();if(this.values[e]){for(var b=0;b<this.values[e].length;b++){var f=this.values[e][b].value.replace(/:/g,"colon");if(document.getElementById(f)){document.getElementById(f).checked="checked"}}}}};SOTE.widget.Selector.toggleValue=function(f){var a=f.data.self;var g=f.target;var c=$("#"+g.id).parent().parent().attr("id");c=c.replace(a.id,"");var d=$("#"+g.id).attr("value");d=d.replace(/colon/,":");var b=$("#"+g.id).attr("checked");if($("#"+g.id).attr("type")=="radio"){a.values[c]=new Array();a.values[c].push({value:d})}else{if(!a.values[c]){a.values[c]=new Array()}if(b!==undefined&&b=="checked"){a.removeItem(c,d);a.values[c].push({value:d})}else{a.removeItem(c,d)}}a.fire()};SOTE.widget.Selector.prototype.removeItem=function(a,c){for(var b=0;b<this.values[a].length;b++){if(this.values[a][b].value==c){this.values[a].splice(b,1)}}};SOTE.widget.Selector.prototype.fire=function(){if(REGISTRY){REGISTRY.fire(this)}else{alert("No REGISTRY found! Cannot fire to REGISTRY from Selector!")}};SOTE.widget.Selector.prototype.setValue=function(a){this.values=this.unserialize(a);return this.validate()};SOTE.widget.Selector.prototype.getValue=function(){var a=this.serialize(this.values);return this.id+"="+a};SOTE.widget.Selector.prototype.serialize=function(a){var e="";for(var c=0;c<this.categories.length;c++){if(c>0){e+="~"}var d=this.categories[c].replace(/\s/g,"");d=d.toLowerCase();e+=d;if(a[d]){for(var b=0;b<a[d].length;b++){e+="."+a[d][b].value}}}return e};SOTE.widget.Selector.prototype.unserialize=function(d){var f=new Object;var b=d.split("~");for(var e=0;e<b.length;e++){var a=b[e].split(".");f[a[0]]=new Array;for(var c=1;c<a.length;c++){f[a[0]].push({value:a[c]})}}return f};SOTE.widget.Selector.prototype.updateComponent=function(b){var a=(b===undefined)?"":b;SOTE.widget.Selector.handleUpdateSuccess(this,a)};SOTE.widget.Selector.handleUpdateSuccess=function(b,a){if(SOTE.util.extractFromQuery("switch",a)==b.state){var c=SOTE.util.extractFromQuery("products",a);b.values=b.unserialize(c);if(b.openCat!==undefined&&b.openCat!==null){b.adjustSelected()}}else{b.state=SOTE.util.extractFromQuery("switch",a);b.loadData()}};SOTE.widget.Selector.handleUpdateFailure=function(d,a,c,b){alert("Failed to load data accessor: "+c)};SOTE.widget.Selector.prototype.loadFromQuery=function(a){};SOTE.widget.Selector.prototype.validate=function(){var a=true;return a};SOTE.widget.Selector.prototype.setDataSourceUrl=function(a){this.dataSourceUrl=a};SOTE.widget.Selector.prototype.getDataSourceUrl=function(){return this.dataSourceUrl};SOTE.widget.Selector.prototype.setStatus=function(a){this.statusStr=a};SOTE.widget.Selector.prototype.getStatus=function(){return this.statusStr};
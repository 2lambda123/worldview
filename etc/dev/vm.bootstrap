#!/bin/bash

set -e

cd /vagrant
if [ ! -d options ] ; then
    echo "ERROR: options directory does not exist" >&2
    exit 1
fi

if ! rpm -q epel-release; then
    yum install -y http://mirrors.kernel.org/fedora-epel/7/x86_64/e/epel-release-7-2.noarch.rpm
fi

yum install -y \
    httpd \
    git \
    nodejs \
    npm \
    python-virtualenv

# The certificate used for npmjs.org has changed and it is not recognized by
# the bundled CA: https://github.com/npm/npm-www/issues/185
#
# Workaround is to not verify ssl certificate:
#npm config set strict-ssl false

npm install -g grunt-cli
npm install
rm -rf python
./wv-python
grunt
grunt apache-config
cp dist/worldview-dev.httpd.conf /etc/httpd/conf.d

systemctl enable httpd.service
systemctl start httpd.service
systemctl stop firewalld.service
systemctl disable firewalld.service

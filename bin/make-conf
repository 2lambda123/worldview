#!/bin/bash
#
# NASA Worldview
#
# This code was originally developed at NASA/Goddard Space Flight Center for
# the Earth Science Data and Information System (ESDIS) project.
#
# Copyright (C) 2013 - 2014 United States Government as represented by the
# Administrator of the National Aeronautics and Space Administration.
# All Rights Reserved.
#

set -e

BASE_DIR=$(dirname "$0")
BUILD_DIR="$BASE_DIR"/../build/conf
DEBUG_DIR="$BASE_DIR"/../build/worldview-debug/web/conf

rm -rf $BUILD_DIR ; mkdir -p $BUILD_DIR
rm -rf $DEBUG_DIR ; mkdir -p $DEBUG_DIR

cp -r $BASE_DIR/../conf/* $BUILD_DIR

[ "$GIBS_HOST" ] || GIBS_HOST="map1"
sed -i -e s/@GIBS_HOST@/${GIBS_HOST}/g "$BUILD_DIR"/web/main/sources.json
rm -f "$BUILD_DIR"/web/main/sources.json-e

"$BASE_DIR"/gibs2wv "$BUILD_DIR"/../gc/*.xml \
    > "$BUILD_DIR"/web/main/gc.json
"$BASE_DIR"/conf-cat --input-dir "$BUILD_DIR"/web/main \
    > "$DEBUG_DIR"/wv.json
"$BASE_DIR"/conf-cat --input-dir "$BUILD_DIR"/web/palettes/custom \
    > "$DEBUG_DIR"/palettes.json
cp -r "$BUILD_DIR"/web/palettes/rendered \
    "$DEBUG_DIR"/palettes
"$BASE_DIR"/sld2wv --output-dir "$DEBUG_DIR"/palettes \
    "$BUILD_DIR"/sld/*.xml


cp -r "$DEBUG_DIR" "$BASE_DIR"/../src
